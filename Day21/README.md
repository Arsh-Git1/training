# Project 01: 
## Project Overview:

#### The goal of this capstone project is to combine shell scripting with system monitoring and log management practices. You will create a set of automated tools using shell scripts to manage logs, monitor system performance using Prometheus and Node Exporter, and generate insights using PromQL queries. The project will require a systematic approach, covering scripting fundamentals, log management, and monitoring setup.

## Project Deliverables:

### 1. Shell Scripts for Basic Operations:

#### Task: 
* Write shell scripts to perform basic system operations, such as checking disk usage, memory usage, and CPU load.

#### Deliverable:
* A collection of scripts that output system performance metrics.
* Scripts should include error handling and logging.

```sh
#!/bin/bash
 
THRESHOLD_CPU=80

THRESHOLD_MEM=80
 
get_system_metrics() {

    echo -e "\n CPU Usage: "

    echo      "------------"

    CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | sed 's/.*, *\([0-9.]*\)%* id.*/\1/')

    MEMORY_USAGE=$(free | awk '/Mem/{printf("%.2f"), $3/$2*100}')

    DISK_SPACE=$(df -h / | awk '/\//{print $(NF-1)}')
 
    echo "CPU_USAGE=$CPU_USAGE"

    echo "MEMORY_USAGE=$MEMORY_USAGE"

    echo "DISK_SPACE=$DISK_SPACE"
 
    echo -e "\n Network Stats: "

    echo      "----------------"

    NETWORK_STATS=$(netstat -i)

    echo "$NETWORK_STATS"
 
    echo -e "\n Top Processes: "

    echo      "----------------"

    TOP_PROCESSES=$(top -bn 1 | head -n 10)

    echo "$TOP_PROCESSES"

}
 
# Check CPU usage

CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | sed 's/.*, *\([0-9.]*\)%* id.*/\1/')

if (( $(echo "$CPU_USAGE >= $THRESHOLD_CPU" | bc -l) )); then

    echo "High CPU usage detected: $CPU_USAGE%"

fi
 
# Check Memory usage

MEMORY_USAGE=$(free | awk '/Mem/{printf("%.2f"), $3/$2*100}')

if (( $(echo "$MEMORY_USAGE >= $THRESHOLD_MEM" | bc -l) )); then

    echo "High memory usage detected: $MEMORY_USAGE%"

fi
 
# Create report file

REPORT_FILE="/tmp/system_report_$(date +'%Y%m%d_%H%M%S').txt"

echo "System Report $(date)" >> $REPORT_FILE

get_system_metrics >> $REPORT_FILE
 
# Menu for user selection

echo "Select an option:

1. Check system metrics

2. Exit"
 
read -r choice
 
case $choice in

    1) get_system_metrics ;;

    2) exit ;;

    *) echo "Invalid option" ;;

esac
```

![alt text](<images/Screenshot from 2024-08-08 19-30-17.png>)

### 2. Log Management Script:

#### Task: 
* Develop a script to automate log management tasks such as log rotation and archiving. This script should include the ability to compress old logs and delete logs older than a specified number of days.

#### Deliverable:
* A shell script that performs log rotation based on predefined conditions (e.g., log size, log age).
* A report generated by the script detailing which logs were rotated, compressed, or deleted.

```sh
#!/bin/bash
 
THRESHOLD_CPU=80

THRESHOLD_MEM=80
 
get_log_analysis() {

    echo -e "\n Error Logs: "

    echo      "-------------"

    ERROR_LOGS=$(grep -iE "error|critical" /var/log/syslog | tail -n 20)

    echo "$ERROR_LOGS"
 
    echo -e "\n Recent Logs: "

    echo      "--------------"

    RECENT_LOGS=$(tail -n 20 /var/log/syslog)

    echo "$RECENT_LOGS"

}
 
# Create report file

REPORT_FILE="/tmp/system_report_$(date +'%Y%m%d_%H%M%S').txt"

echo "System Report $(date)" >> $REPORT_FILE

get_log_analysis >> $REPORT_FILE
 
# Menu for user selection

echo "Select an option:

1. View logs

2. Exit"
 
read -r choice
 
case $choice in

    1) get_log_analysis ;;

    2) exit ;;

    *) echo "Invalid option" ;;

esac
```
![alt text](<images/Screenshot from 2024-08-08 19-30-40.png>)

![alt text](<images/Screenshot from 2024-08-08 19-30-53.png>)

### 3. Advanced Shell Scripting - Loops, Conditions, Functions, and Error Handling:

#### Task: 
* Refactor the previous scripts to include loops, conditionals, and functions for modularity. Implement error handling to manage potential issues during script execution.

#### Deliverable:
* Modular shell scripts that use functions for repeatable tasks.
* Error-handling mechanisms in place for scenarios like missing files, insufficient permissions, etc.
* Logs that track script execution and any errors encountered.

```sh
#!/bin/bash

# Define the output file 

OUTPUT_FILE="log-status.txt"

# Functions Of disk_usage , Check Memory and check CPU load
check_log() {
    echo "logs are shown below :-"
    cat /var/log/syslog | tail -n 4
    echo
}

# Write the results to the output file if specified
if [ -n "$OUTPUT_FILE" ]; then
    {
        check_log
    } > "$OUTPUT_FILE" 

    echo "Report saved to $OUTPUT_FILE"
fi
```
![alt text](<images/Screenshot from 2024-08-08 19-58-59.png>)

### 4. Log Checking and Troubleshooting:

#### Task: 
Write a script that reads through system and application logs, identifies common issues (e.g., out of memory, failed service starts), and provides troubleshooting steps based on log analysis.

#### Deliverable:
* A script that parses logs for errors or warnings and outputs possible root causes.
* Documentation on the types of logs checked and the issues identified.
* A troubleshooting guide based on common errors found in the logs.

```sh
#!/bin/bash

SYSLOG_FILE="/var/log/syslog"
AUTH_LOG_FILE="/var/log/auth.log"

check_logs() {
    local file=$1
    local keyword=$2
    echo "Checking $file for '$keyword'..."
    grep "$keyword" "$file" | tail -n 5
}

echo "Starting log check..."
echo "System Log Errors "
check_logs $SYSLOG_FILE "error"

echo "Authentication Failures "
check_logs $AUTH_LOG_FILE "authentication failure"

echo "Log check completed."
```
![alt text](<Screenshot from 2024-08-08 20-58-21.png>)

### 5. Installation and Setup of Prometheus and Node Exporter:

#### Task: 
Install and configure Prometheus and Node Exporter on the system. Ensure that Node Exporter is properly configured to collect system metrics.

#### Deliverable:
* A documented installation and configuration process for Prometheus and Node Exporter.
* A running instance of Prometheus scraping metrics from Node Exporter.

### Steps to install Prometheus

* First download the zip file from

```
wget https://github.com/prometheus/prometheus/releases/download/v2.53.1/prometheus-2.53.1.linux-amd64.tar.gz
```

* then to unzip it run

```
tar -xvf prometheus-2.53.1.linux-amd64.tar.gz
```

* Then change directory

```
cd prometheus-2.53.1.linux-amd64/
```

* And try to run Prometheus

```
./prometheus 
```

### Output

![alt text](<Screenshot from 2024-08-08 22-02-41.png>)

### Steps to install Node-Exporter

* First Download the Zip

```
wget https://github.com/prometheus/node_exporter/releases/download/v1.8.2/node_exporter-1.8.2.linux-amd64.tar.gz
```

* Unzip the file using:

```
tar -xvf node_exporter-1.8.2.linux-amd64.tar.gz
```

* Change the directory path

```
cd node_exporter-1.8.2.linux-amd64/
```

* And try to run

```
./node_exporter 
```

### Output

![alt text](<Screenshot from 2024-08-08 19-31-55.png>)



### 6. Prometheus Query Language (PromQL) Basic Queries:

#### Task: 
Create a series of PromQL queries to monitor system performance, such as CPU usage, memory usage, and disk I/O.

#### Deliverable:
* A set of PromQL queries that can be used to monitor key system metrics.
* A dashboard setup guide or configuration that visualizes these metrics in Prometheus or Grafana.


* add a sample node_exporter job

```
  # sample node_exporter job
  - job_name: "node"
    static_configs:
      - targets: ["localhost:9100"]

    The Run the query
```


* The Run the query

### Output

```
rate(node_cpu_seconds_total[5m])
```

![alt text](<Screenshot from 2024-08-08 19-15-07.png>)

![alt text](<Screenshot from 2024-08-08 19-15-01.png>)

```
100 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes * 100)
```

![alt text](<Screenshot from 2024-08-08 22-15-48.png>)

### 7. Final Report and Presentation:

#### Task: 
* Prepare a final report documenting all scripts, the installation and configuration of monitoring tools, and the output of your PromQL queries.

#### Deliverable:
* A comprehensive project report covering all steps, scripts, and results.




